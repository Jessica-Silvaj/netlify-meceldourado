<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ†Ô∏è Mec√¢nica üõ†Ô∏è</title>
    <link rel="icon" href="./images/favicon.ico">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./fonts/Poppins-Medium.otf" />
    <link rel="stylesheet" href="./fonts/Poppins-Regular.otf" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="App">
        <div class="background">
            <div class="background-login">
                <div class="backgroundLoginWeb2">
                    <div id="alertContainer"></div>
                </div>
            </div>
            <div class="container-background">
                <div class="logoMec"></div>
                <div class="container-text">
                    <b>Sistema de Gerenciamento de Ponto</b>
                </div>
                <form method="POST" autocomplete="off">
                    <div class="container-input">
                        <div class="mb-3">
                            <label for="username" class="textInput"><b>Nome do Personagem ou ID:</b></label>
                            <input type="text" class="inputLogin" id="username" name="username" required>
                        </div>
                        <div class=" col-md-12">
                            <label for="password" class="textInput"><b>Senha:</b></label>
                            <input type="password" class="inputLogin" id="password" name="password" required>
                        </div>
                    </div>
                    <div class="container-buttons">
                        <div class="col-6">
                            <button class="buttonLoginWeb" type="submit">Fazer Login</button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="buttonLoginWeb" data-bs-toggle="modal"
                                data-bs-target="#registerModal">Registrar-se</button>
                        </div>
                    </div>
            </div>
            </form>
        </div>
    </div>
    </div>

    <!-- Modal de Registro -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel"><b>Registrar-se no sistema</b></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form autocomplete="off" id="registroForm" method="POST"  action="../functions/registrar.js">
                        <div class="mb-3">
                            <label for="registerUsername" class="textInput"><b>Nome do Personagem:</b></label>
                            <input type="text" class="inputLoginModal" id="name" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerUsername" class="textInput"><b>Id do Personagem:</b></label>
                            <input type="text" class="inputLoginModal" id="passaport" name="passaport" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerUsername" class="textInput"><b>Nome do Discord:</b></label>
                            <input type="text" class="inputLoginModal" id="discordName" name="discordName" required>
                        </div> 
                        <div class="mb-3">
                            <label for="registerPassword" class="textInput"><b>Senha:</b></label>
                            <input type="password" class="inputLoginModal" id="passwordModal" name="passwordModal" required>
                        </div>
                </div>
                <div class="container-buttons">
                    <button type="submit" class="buttonLogin">Registrar</button>
                </div>
                </form>
            </div>
        </div>
    </div>
    </div>
    <script>
       document.getElementById('registroForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Impede a submiss√£o padr√£o do formul√°rio

            const formData = new FormData(event.target);
            const data = {
                characterName: formData.get('name'),
                characterId: formData.get('passaport'),
                discordName: formData.get('discordName'),
                password: formData.get('passwordModal'),
            };

            try {
                const response = await fetch('/.netlify/functions/registrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`${errorData.message}`);
                }

                const responseData = await response.json();
                
                const alertContainer = document.getElementById('alertContainer');
                alertContainer.innerHTML = `
                    <div class="alert alert-${responseData.type} alert-dismissible fade show" role="alert">
                        ${responseData.message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;

                if (responseData.type === 'success') {
                    event.target.reset();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                    if (modal) {
                        modal.hide();
                    }
                }
            } catch (error) {
                const alertContainer = document.getElementById('alertContainer');
                alertContainer.innerHTML = `
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        ${error}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
            } finally {
                // Fecha o modal independentemente de sucesso ou erro
                const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                if (modal) {
                    modal.hide();
                }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous">
    </script>
</body>
</html>